<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    <title>Spencer's Blog</title>

    <meta name="author" content="Spencer's Blog" />
    <meta name="description" content="Linux, and Cloud, and Automation Tools! Oh My!">

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="/blog.css">
    <link rel="stylesheet" href="/pygments.css">
  </head>

  <body>

  <div class="blog-masthead navbar-fixed-top">
    <div class="container">
      <nav class="blog-nav">
        <a class="blog-nav-item" href="/">Home</a>
        <a class="blog-nav-item" href="#">About</a>
      </nav>
    </div>
  </div>

  <div class="container">
    <div class="blog-header">
      <h1 class="blog-title">Spencer's Blog</h1>
      <p class="lead blog-description">Linux, and Cloud, and Automation Tools! Oh My!</p>
    </div>

    <div class="row">
      <div class="col-sm-9 blog-main">
          <div class="blog-post">   
            <h2 class="blog-post-title">Installing CFEngine</h2>
            <p class="blog-post-meta">Written 02.15.2015 by Spencer</p>
            <hr>
              <p>Continuing on my thread of exploring new technologies for my new job, today I’ll
be looking at CFEngine and how we can use it for configuration management. I’ve
used other tools like Chef and Ansible in the past, but CFEngine is a new one
for me. I’ll be installing and configuring a server and some nodes in my home
Openstack lab.</p>

<h2 id="setup-the-server"><strong>Setup the Server</strong></h2>
<p>I’m going to use the instructions for CFEngine enterprise for this tutorial. It
appears to be free for the first 25 nodes, so it will be nice to test against the
version that I may actually have to use at work.</p>

<ul>
  <li>
    <p>Create a server in Openstack and go ahead and SSH in. I had to use a Ubuntu 12.04
LTS image for this. 14.04 LTS returned an error about not being supported. I imagine
that will be fixed in the future.</p>
  </li>
  <li>
    <p>Open the /etc/hosts file for editing and add an entry for the private IP address to
give it a hostname. The script below with fail if <code>hostname -f</code> doesn’t return
anything. I added this to my hosts file:
<code>10.0.0.18 cfengine-server.localdomain</code>. You may also have to enter
<code>sudo hostname cfengine-server.localdomain</code>.</p>
  </li>
  <li>
    <p>Grab the CFEngine install script with
<code>wget http://s3.amazonaws.com/cfengine.packages/quick-install-cfengine-enterprise.sh</code>.</p>
  </li>
  <li>
    <p>Make it executable with <code>chmod +x quick-install-cfengine-enterprise.sh</code>.</p>
  </li>
  <li>
    <p>Run the script with sudo rights and pass the hub argument to specify that this
will be a central hub server:
<code>sudo ./quick-install-cfengine-enterprise.sh hub</code></p>
  </li>
  <li>
    <p>Bootstrap the CFEngine hub with <code>sudo /var/cfengine/bin/cf-agent --bootstrap 10.0.0.18</code></p>
  </li>
  <li>
    <p>We should now be able to login to the server’s web UI by going to the floating
IP address in a browser. The default login information is admin/admin. <strong>Make sure
your default security group lets port 80 in.</strong>
<a href="/img/posts/2015-02-15-configuration-management-with-cfengine/server-running.png">
<img src="/img/posts/2015-02-15-configuration-management-with-cfengine/server-running.png" style="max-width:100%; border:solid 1px;" /></a></p>
  </li>
</ul>

<h2 id="setup-the-clients"><strong>Setup the Clients</strong></h2>
<p>Now let’s get some clients set up so that we have some systems to actually manage
with our snazzy new server. This process is almost exactly the same as the above,
with the exception of the argument passed to quick-install-cfengine-enterprise.sh.
I won’t copy/paste everything from above, but just follow the same steps and when
you get there, issue this command instead:
<code>sudo ./quick-install-cfengine-enterprise.sh agent</code></p>

<p>One last possible caveat here. I created a Ubuntu 12.04 image with the CFEngine
client installed and it caused a kernel panic on boot. I’m not sure what was going on,
but using a 14.04 image worked just fine.</p>

<p>Once you get the client setup completed, you should see your new nodes checked in
in the web UI.
<a href="/img/posts/2015-02-15-configuration-management-with-cfengine/nodes-checked-in.png">
  <img src="/img/posts/2015-02-15-configuration-management-with-cfengine/nodes-checked-in.png" style="max-width:100%; border:solid 1px;" /></a></p>

            <hr>
            <a href="/"><< Back</a>
          </div>
      </div>

      <div class="col-sm-3 blog-sidebar">
        <div class="sidebar-module sidebar-module-inset">
          <h4>About</h4>
          <p>Hi, welcome to my personal blog. I plan to use this site to document interesting things I've learned on personal projects. I work extensively with OpenStack and Linux at work and tend to try new functionality at home. Because I'm forgetful, I'll write up the the cool things I find in order to keep from asking myself, "How in the heck did I do that?!?!" over and over again.</p>
        </div>
        <div class="sidebar-module sidebar-module-inset">
          <h4>Contact Info</h4>
          <ol class="list-unstyled">
            <li><a href="https://github.com/rsmitty" target="_blank">Github</a></li>
            <li><a href="http://lnkd.in/feXbBV" target="_blank">LinkedIn</a></li>
          </ol>
        </div>
      </div>

    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>


  </body>
</html>
